# Архитектура палитры "Спокойная Четкость"

## Обзор

Новая архитектура палитры "Спокойная Четкость" реализует модульный подход с минимальной базовой палитрой и генерацией цветов на основе этой базы. Это позволяет упростить поддержку, повысить гибкость и обеспечить соответствие требованиям контрастности WCAG.

## Структура палитры

### Базовая палитра (src/theme/palette/base.ts)

Минимальный набор из 5-7 базовых цветов, из которых генерируются все остальные:

```typescript
export interface BasePalette {
  background: string    // #10141a - основной темный синий фон
  accent: string        // #7ab4e6 - основной акцентный цвет
  syntaxPurple: string  // #bb9af7 - для ключевых слов и типов
  syntaxGreen: string   // #9ece6a - для строк и успехов
  neutral: string       // #3a4a60 - для вспомогательных элементов
  syntaxYellow?: string // #e0af68 - опционально для предупреждений
  syntaxCyan?: string   // #7dcfff - опционально для функций
}
```

### Генераторы (src/theme/palette/generators.ts)

Функции для изменения яркости и прозрачности:

- `lighten(color, amount)` - осветление цвета
- `darken(color, amount)` - затемнение цвета
- `withAlpha(color, alpha)` - добавление прозрачности
- `getColorWithAlpha(color, alphaKey)` - применение стандартных уровней прозрачности

### Цветовые утилиты (src/theme/palette/color-utils.ts)

Функции для работы с цветами и проверки контрастности:

- `getContrastRatio(color1, color2)` - коэффициент контрастности
- `meetsWCAGContrast(foreground, background, level)` - проверка соответствия WCAG
- `isLightColor(color)` / `isDarkColor(color)` - определение яркости цвета

### Генераторы компонентов

#### Интерфейс (src/theme/palette/workbench.ts)

Генерирует цвета интерфейса на основе базовой палитры:

- Фоны (background)
- Тексты (foreground)
- Границы (border)
- Акценты (accent)
- Кнопки (button)
- Нейтральные цвета (neutral)
- Элементы управления (controls)
- Миникарта (minimap)
- Полоса обзора (overviewRuler)
- Граф SCM (scmGraph)
- Тени (shadow)

#### Синтаксис (src/theme/palette/syntax.ts)

Генерирует цвета подсветки синтаксиса:

- Комментарии
- Строки
- Числа
- Ключевые слова
- Типы
- Классы
- Функции
- Переменные
- Свойства
- Ошибки/предупреждения

## Преимущества новой архитектуры

1. **Модульность**: каждый компонент палитры находится в отдельном файле
2. **Генерация**: цвета интерфейса и синтаксиса генерируются на основе базовой палитры
3. **Контроль контрастности**: автоматические проверки соответствия WCAG
4. **Легкость модификации**: изменение базового цвета автоматически влияет на все производные
5. **Обратная совместимость**: сохранены все существующие интерфейсы

## Проверка контрастности

Файл `src/theme/palette/validation.ts` содержит функции для проверки контрастности:

- `validatePaletteContrast(palette)` - полная проверка палитры
- `getContrastValidationReport(palette)` - отчет о проверке
- `validateContrastWithBackground` - проверка контраста с фоном
- `validateContrastPairs` - проверка контраста между парами элементов

Проверка автоматически выполняется при сборке темы.

## Интеграция

Все изменения интегрированы в существующий процесс генерации темы:

1. `src/theme/palette/utils.ts` - создание палитры с использованием новых генераторов
2. `src/theme/palette/calm-clarity.ts` - экспорт палитры
3. `src/theme/palette/calm-clarity-syntax.ts` - семантическая подсветка синтаксиса
4. `scripts/build-theme.ts` - автоматическая проверка контрастности при сборке