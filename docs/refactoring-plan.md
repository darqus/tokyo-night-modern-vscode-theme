# План рефакторинга генераторов цветов Tokyo Night

## Обзор задачи

Текущие генераторы в `tokyo-night-generators.ts` содержат жестко закодированные цветовые значения. Необходимо провести рефакторинг для использования централизованных палитр из `base-colors.ts` и `token-colors.ts`, что обеспечит:

- Единообразие цветов
- Легкость поддержки и обновления
- Группировку цветов по категориям
- Расширяемость палитры

## Текущая архитектура

### Генераторы (tokyo-night-generators.ts)

- `generateTokyoNightSemanticTokenColors()` - семантические токены
- `generateTokyoNightWorkbenchColors()` - цвета интерфейса
- `generateTokyoNightTokenColors()` - токены подсветки синтаксиса

### Палитры

- `base-colors.ts` - базовые цвета интерфейса с категориями
- `token-colors.ts` - цвета токенов с категориями
- Обе палитры имеют функции генерации вариантов (lighter, darker, transparent)

## Стратегия рефакторинга

### Фаза 1: Анализ и подготовка

1. **Анализ соответствий цветов**
   - Сопоставить все жестко закодированные цвета с категориями палитр
   - Выявить цвета, отсутствующие в палитрах
   - Определить необходимые дополнения к палитрам

2. **Обновление палитр**
   - Добавить недостающие цвета в `base-colors.ts` и `token-colors.ts`
   - Убедиться в полноте покрытия всех используемых цветов
   - Проверить соответствие WCAG стандартам

### Фаза 2: Рефакторинг генераторов

3. **Рефакторинг generateTokyoNightSemanticTokenColors**
   - Заменить жестко закодированные цвета на ссылки из `baseTokenColors.semantic`
   - Использовать категории: namespace, type, class, variable, property, method, etc.
   - Применить варианты (base, lighter, darker) где необходимо

4. **Рефакторинг generateTokyoNightWorkbenchColors**
   - Заменить цвета на ссылки из `baseColors` с категориями:
     - background (primary, secondary, tertiary, border)
     - foreground (primary, secondary, disabled, hint)
     - accent (primary, secondary, success, warning, error)
     - neutral, syntax, terminal, charts, uiComponents
   - Использовать прозрачные варианты для overlay эффектов

5. **Рефакторинг generateTokyoNightTokenColors**
   - Заменить цвета на ссылки из `baseTokenColors` с категориями:
     - comments, strings, keywords, types, functions, variables
     - operators, punctuation, special, semantic
   - Группировать правила по категориям для лучшей читаемости

### Фаза 3: Интеграция и оптимизация

6. **Обновление импортов**
   - Импортировать палитры в `tokyo-night-generators.ts`
   - Удалить дублирование цветовых значений
   - Оптимизировать структуру импортов

7. **Создание утилитарных функций**
   - Добавить helper-функции для получения цветов из палитр
   - Создать функции для применения вариантов (lighter, darker, transparent)
   - Обеспечить обратную совместимость

### Фаза 4: Тестирование и валидация

8. **Модульное тестирование**
   - Проверить, что все цвета правильно ссылаются на палитры
   - Убедиться в корректности применения вариантов
   - Проверить производительность генераторов

9. **Интеграционное тестирование**
   - Сгенерировать тему и сравнить с оригиналом
   - Проверить визуальную идентичность
   - Тестировать на различных языках программирования

10. **Валидация контрастности**
    - Запустить проверки WCAG для всех комбинаций цветов
    - Исправить проблемы контрастности при обнаружении

### Фаза 5: Документация и развертывание

11. **Обновление документации**
    - Обновить `color-palette-summary.md` с новой архитектурой
    - Добавить раздел о рефакторинге и преимуществах
    - Создать гайд по расширению палитр

12. **Создание changelog**
    - Документировать все изменения в CHANGELOG.md
    - Описать преимущества нового подхода
    - Указать потенциальные breaking changes

## Преимущества рефакторинга

- **Централизованное управление**: Все цвета в одном месте
- **Согласованность**: Единообразие цветов во всей теме
- **Расширяемость**: Легкое добавление новых цветов и языков
- **Поддерживаемость**: Упрощение обновления и модификации
- **Производительность**: Оптимизированные функции генерации

## Риски и mitigation

- **Риск потери цветов**: Тщательный анализ всех использований
- **Производительность**: Тестирование скорости генерации
- **Совместимость**: Проверка обратной совместимости

## Критерии успеха

- Все цвета ссылаются на палитры вместо жесткого кодирования
- Тема визуально идентична оригиналу
- Все тесты проходят
- Контрастность соответствует WCAG AA
- Документация обновлена
