# План реализации новой системы цветов

Этот документ описывает план по рефакторингу и замене прямых использований `foundationColors` на семантические токены в UI-модулях темы. Цель — повысить семантическую целостность, упростить поддержку и централизовать управление цветами.

## 1. Общая стратегия

Рефакторинг будет состоять из двух основных шагов:

1. **Создание новых семантических токенов:** В файле `src/theme/palette/semantic.ts` будут добавлены новые токены, которые семантически описывают назначение цвета (например, `terminal.ansi.blue` или `git.modified`).
2. **Замена `foundationColors`:** Во всех `ui-modules/*.ts` файлах прямые вызовы `foundationColors` будут заменены на новые семантические токены с помощью хелпера `getToken()`.

## 2. Новые семантические токены

Для замены всех "сырых" цветов потребуется создать следующие новые семантические группы токенов в `src/theme/palette/semantic.ts`:

### 2.1. Цвета для терминала

```typescript
// src/theme/palette/semantic.ts

export const terminal = {
  ansi: {
    black: palette.gray400,
    blue: palette.blue500,
    brightBlack: palette.gray400,
    brightBlue: palette.blue500,
    brightCyan: palette.cyan500,
    brightGreen: palette.green500,
    brightMagenta: palette.purple500,
    brightRed: palette.red50,
    brightWhite: palette.gray100,
    brightYellow: palette.yellow500,
    cyan: palette.cyan500,
    green: palette.green500,
    magenta: palette.purple500,
    red: palette.red500,
    white: palette.gray100,
    yellow: palette.yellow500,
  },
  background: palette.gray900,
  foreground: palette.gray500,
  border: palette.gray600.alpha(0.25), // 40 в hex -> 25%
  dropBackground: palette.blue500.alpha(0.2), // 33 в hex -> ~20%
  selectionBackground: palette.blue500.alpha(0.19), // 30 в hex -> ~19%
  tabActiveBorder: palette.blue500,
  commandDecoration: {
    default: palette.yellow500,
    error: palette.red500,
    success: palette.cyan500,
  },
  cursor: {
    background: palette.gray800,
    foreground: palette.yellow500,
  },
  overviewRuler: {
      cursorForeground: palette.yellow500,
  }
};
```

### 2.2. Цвета для Git-декораций

```typescript
// src/theme/palette/semantic.ts

export const git = {
  modified: palette.purple500,
  ignored: palette.gray500,
  deleted: palette.red500,
  renamed: palette.blue500,
  added: palette.blue500,
  untracked: palette.cyan500,
  conflicting: palette.yellow500,
  stageDeleted: palette.red500,
  stageModified: palette.purple500,
};
```

### 2.3. Цвета для значков (Badges)

```typescript
// src/theme/palette/semantic.ts

export const badge = {
  background: palette.purple800,
  foreground: palette.gray100, // Замена foundationColors.white
};
```

### 2.4. Цвета для скобок редактора

```typescript
// src/theme/palette/semantic.ts

export const syntax = {
  // ... другие токены
  brackets: {
    '1': palette.blue500,
    '2': palette.blue500,
    '3': palette.purple500,
    '4': palette.cyan500,
    '5': palette.green500,
    '6': palette.yellow500,
    unexpected: palette.red500,
  },
};
```

## 3. План замены по файлам

Ниже представлен детальный план по замене `foundationColors` на семантические токены для каждого затронутого модуля.

---

### `src/theme/ui-modules/merges.ts`

| UI Property | Старое значение | Новое значение |
|---|---|---|
| `merge.currentContentBackground` | `foundationColors.blue500 + '44'` | `getToken('accent.primary').alpha(0.27)` |
| `merge.currentHeaderBackground` | `foundationColors.blue500 + 'AA'` | `getToken('accent.primary').alpha(0.67)` |
| `merge.incomingContentBackground` | `foundationColors.purple500 + '44'` | `getToken('syntax.method').alpha(0.27)` |
| `merge.incomingHeaderBackground` | `foundationColors.purple500 + 'AA'` | `getToken('syntax.method').alpha(0.67)` |

---

### `src/theme/ui-modules/notifications-widgets.ts`

| UI Property | Старое значение | Новое значение |
|---|---|---|
| `debugExceptionWidget.background` | `foundationColors.gray800` | `getToken('background.surface')` |
| `debugExceptionWidget.border` | `foundationColors.red500` | `getToken('error')` |
| `notificationCenterHeader.background` | `foundationColors.gray800` | `getToken('background.surface')` |
| `notificationCenterHeader.foreground` | `foundationColors.gray100` | `getToken('text.primary')` |
| `notificationLink.foreground` | `foundationColors.gray600` | `getToken('text.secondary')` |
| `notifications.background` | `foundationColors.gray800` | `getToken('background.surface')` |
| `notifications.foreground` | `foundationColors.gray100` | `getToken('text.primary')` |
| `notificationsErrorIcon.foreground` | `foundationColors.red500` | `getToken('error')` |
| `notificationsInfoIcon.foreground` | `foundationColors.cyan500` | `getToken('info')` |
| `notificationsWarningIcon.foreground` | `foundationColors.yellow500`| `getToken('warning')` |

---

### `src/theme/ui-modules/terminal.ts`

Будет полностью заменен на использование токенов из новой группы `terminal`.

---

### `src/theme/ui-modules/badges.ts`

| UI Property | Старое значение | Новое значение |
|---|---|---|
| `badge.background` | `foundationColors.purple800` | `getToken('badge.background')` |
| `badge.foreground` | `foundationColors.white` | `getToken('badge.foreground')` |
| `activityBarBadge.background` | `foundationColors.purple800` | `getToken('badge.background')` |
| `activityBarBadge.foreground` | `foundationColors.white` | `getToken('badge.foreground')` |
| `extensionBadge.remoteBackground` | `foundationColors.purple800` | `getToken('badge.background')` |
| `extensionBadge.remoteForeground` | `foundationColors.white` | `getToken('badge.foreground')` |

---

### `src/theme/ui-modules/git-decoration.ts`

Будет полностью заменен на использование токенов из новой группы `git`.

---

### `src/theme/ui-modules/editor.ts`

| UI Property | Старое значение | Новое значение |
|---|---|---|
| `editor.foreground` | `foundationColors.gray100` | `getToken('text.primary')` |
| `editorBracketHighlight.foreground1` | `foundationColors.blue500` | `getToken('syntax.brackets.1')` |
| `editorBracketHighlight.foreground2` | `foundationColors.blue500` | `getToken('syntax.brackets.2')` |
| `editorBracketHighlight.foreground3` | `foundationColors.purple500` | `getToken('syntax.brackets.3')` |
| `editorBracketHighlight.foreground4` | `foundationColors.cyan500` | `getToken('syntax.brackets.4')` |
| `editorBracketHighlight.foreground5` | `foundationColors.green500` | `getToken('syntax.brackets.5')` |
| `editorBracketHighlight.foreground6` | `foundationColors.yellow500` | `getToken('syntax.brackets.6')` |
| `editorBracketHighlight.unexpectedBracket.foreground` | `foundationColors.red500` | `getToken('syntax.brackets.unexpected')` |
| ... и так далее для остальных свойств | ... | ... |

*Примечание: для краткости приведены только примеры. План подразумевает замену **всех** использований `foundationColors` в этом файле.*

## 4. Последовательность действий

1. **Реализация новых токенов:** Добавить новые группы токенов (`terminal`, `git`, `badge`, `syntax.brackets`) в файл `src/theme/palette/semantic.ts`.
2. **Рефакторинг UI-модулей:** Последовательно пройти по каждому файлу из списка в `src/theme/ui-modules/` и заменить все обращения к `foundationColors` на вызовы `getToken()` с соответствующим семантическим токеном.
3. **Валидация и тестирование:** После внесения изменений запустить скрипты сборки и валидации (`build-theme`, `validate-theme`), чтобы убедиться, что тема генерируется корректно и не содержит ошибок.
4. **Визуальная проверка:** Вручную проверить внешний вид VS Code с новой темой, обращая особое внимание на измененные компоненты (терминал, Git-статусы, значки, подсветку скобок).

Этот план является техническим заданием для следующего этапа — реализации.
