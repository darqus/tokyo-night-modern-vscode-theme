# План миграции на систему дизайн-токенов

## Обзор

Этот документ описывает пошаговый план миграции существующей кодовой базы с использованием прямых ссылок на цвета из `palette` на новую систему дизайн-токенов с использованием функции `getToken()`.

## Цели миграции

1. Централизовать управление цветами через систему дизайн-токенов
2. Обеспечить согласованность цветов по всему приложению
3. Упростить поддержку тем (светлая/темная)
4. Обеспечить доступность (соответствие WCAG) для всех цветовых комбинаций
5. Подготовить систему к расширению (новые токены для отступов, типографики и т.д.)

## Стратегия миграции

Миграция будет выполнена поэтапно, по модулям, чтобы минимизировать риски и обеспечить возможность тестирования на каждом этапе. Мы будем использовать подход "синий/зеленый", позволяющий постепенно переключаться с старой системы на новую.

## Подробный план миграции

### Этап 1: Подготовка инфраструктуры

1. **Создание системы дизайн-токенов** (уже выполнено)
   - [`src/theme/design-tokens.ts`](../src/theme/design-tokens.ts) - основная система токенов
   - [`src/theme/light-theme-tokens.ts`](../src/theme/light-theme-tokens.ts) - токены для светлой темы
   - [`src/theme/token-utils.ts`](../src/theme/token-utils.ts) - утилиты для работы с токенами
   - [`src/theme/token-validation.ts`](../src/theme/token-validation.ts) - валидация токенов

2. **Создание сопоставления старых цветов с новыми токенами**
   - Для каждого цвета из `palette` определить соответствующий токен
   - Создать маппинг для облегчения миграции

### Этап 2: Миграция UI-модулей

Миграция будет происходить по следующему плану:

#### 2.1. Миграция модулей с наименьшей связанностью

1. **Модуль `drop-backgrounds.ts`**
   - Простые цвета для фона при перетаскивании
   - Мало зависимостей
   - Заменить `palette.special.highlight + '33'` на соответствующий токен

2. **Модуль `scm-graph.ts`**
   - Только цвета для истории Git
   - Минимальное количество цветов для замены

3. **Модуль `command-center.ts`**
   - Простые фоны и границы
   - Прямые замены цветов

#### 2.2. Миграция модулей средней сложности

4. **Модуль `badges.ts`**
   - Цвета для бейджей
   - Использует основные цвета (фиолетовый и белый)

5. **Модуль `title-bar.ts`**
   - Простые цвета для заголовка окна
   - Фоны и текст

6. **Модуль `activity-bar.ts`**
   - Цвета для панели активности
   - Использует синий и серые оттенки

7. **Модуль `status-bar.ts`**
   - Цвета для строки состояния
   - Включает цвета для отладки и удаленной разработки

8. **Модуль `side-bar.ts`**
   - Цвета для боковой панели
   - Использует вторичный фон и синий цвет

9. **Модуль `tabs.ts`**
   - Цвета для вкладок
   - Активные/неактивные состояния

#### 2.3. Миграция модулей с высокой сложностью

10. **Модуль `inputs-buttons.ts`**
    - Цвета для кнопок и полей ввода
    - Много состояний (hover, active, disabled)
    - Цвета валидации

11. **Модуль `menus-dropdowns.ts`**
    - Цвета для меню и выпадающих списков
    - Выделенные элементы и разделители

12. **Модуль `lists.ts`**
    - Цвета для списков
    - Много состояний и типов элементов

13. **Модуль `find-search.ts`**
    - Цвета для поиска и выделения результатов
    - Использует цвета выделения

14. **Модуль `terminal.ts`**
    - Цвета для терминала
    - ANSI цвета и цвета команд

15. **Модуль `editor.ts`**
    - Цвета для редактора
    - Много различных элементов (скобки, подсветка, линии и т.д.)

16. **Модуль `editor-groups-panels.ts`**
    - Цвета для групп редакторов и панелей
    - Границы и фоны

17. **Модуль `highlights.ts`**
    - Цвета для подсветки
    - Выделение слов и диапазонов

18. **Модуль `peek-view.ts`**
    - Цвета для просмотра
    - Использует цвета подсветки

19. **Модуль `notifications-widgets.ts`**
    - Цвета для уведомлений
    - Иконки ошибок, предупреждений и т.д.

20. **Модуль `git-decoration.ts`**
    - Цвета для Git аннотаций
    - Состояния файлов (измененные, удаленные и т.д.)

21. **Модуль `toolbar-debug.ts`**
    - Цвета для отладки
    - Переменные и выражения

22. **Модуль `diffs.ts`**
    - Цвета для диффов
    - Вставки и удаления

23. **Модуль `scrollbar-minimap.ts`**
    - Цвета для полосы прокрутки и миникарты
    - Много различных элементов

24. **Модуль `text.ts`**
    - Цвета для текста
    - Блоки кода и цитаты

### Этап 3: Миграция синтаксических токенов

25. **Модуль `semantic.ts`**
    - Семантические цвета для синтаксиса
    - Методы и переменные

26. **Модуль `tokens/modules/common.ts`**
    - Общие синтаксические токены
    - Комментарии, константы, ключевые слова

27. **Модуль `tokens/modules/javascript.ts`**
    - Специфические цвета для JavaScript
    - Переменные, свойства, функции

28. **Модуль `tokens/modules/typescript.ts`**
    - Специфические цвета для TypeScript
    - Типы и ключевые слова

29. **Модуль `tokens/modules/html.ts`**
    - Специфические цвета для HTML
    - Теги и атрибуты

30. **Модуль `tokens/modules/css.ts`**
    - Специфические цвета для CSS
    - Свойства и псевдоэлементы

31. **Модуль `tokens/modules/json.ts`**
    - Специфические цвета для JSON
    - Ключи

32. **Модуль `tokens/modules/markdown.ts`**
    - Специфические цвета для Markdown
    - Заголовки, код, ссылки

33. **Модуль `tokens/modules/` других языков**
    - Остальные языки программирования
    - Go, Python, Rust, Java и т.д.

### Этап 4: Обновление основных файлов

34. **Обновление `ui.ts`**
    - Центральный файл для UI цветов
    - Сборка всех UI-модулей

35. **Обновление `tokens.ts`**
    - Центральный файл для синтаксических токенов
    - Сборка всех токен-модулей

36. **Обновление `semantic.ts`**
    - Семантические цвета
    - Обновление после миграции модулей

### Этап 5: Тестирование и валидация

37. **Валидация токенов**
    - Запуск системы валидации токенов
    - Проверка на соответствие WCAG

38. **Визуальное тестирование**
    - Сравнение внешнего вида до и после миграции
    - Проверка обеих тем (светлая/темная)

39. **Функциональное тестирование**
    - Проверка всех UI-компонентов
    - Проверка синтаксической подсветки

## Инструменты для миграции

1. **Скрипт для поиска использования цветов**
   - Автоматический скан файлов на наличие `palette.`
   - Генерация отчета о текущем использовании

2. **Скрипт для замены цветов**
   - Автоматическая замена `palette.colorName` на `getToken('color.category.variant')`
   - Сопоставление по заранее созданному маппингу

3. **Система валидации**
   - Проверка корректности миграции
   - Проверка на соответствие WCAG

## Критерии завершения

1. Все файлы в `src/theme/ui-modules/` используют `getToken()` вместо прямого обращения к `palette`
2. Все файлы в `src/theme/tokens/modules/` используют `getToken()` вместо прямого обращения к `palette`
3. Система валидации токенов не выдает ошибок
4. Все цветовые комбинации соответствуют стандартам доступности WCAG
5. Внешний вид темы не изменился (или улучшился) по сравнению с оригиналом
6. Обе темы (светлая и темная) работают корректно

## Риски и меры по их снижению

1. **Риск: Нарушение визуального соответствия**
   - Мера: Тщательное визуальное тестирование на каждом этапе
   - Мера: Использование автоматизированных скриншотов для сравнения

2. **Риск: Ошибки доступности**
   - Мера: Использование встроенной системы валидации контрастности
   - Мера: Проверка всех комбинаций текста и фона

3. **Риск: Пропуск некоторых цветов при миграции**
   - Мера: Использование скрипта для поиска всех упоминаний `palette.`
   - Мера: Проверка с помощью статического анализа

4. **Риск: Внесение ошибок при автоматической замене**
   - Мера: Пошаговая миграция с тестированием после каждого шага
   - Мера: Использование системы контроля версий для отката изменений
